{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Box,Typography,Paper,Grid,CircularProgress}from'@mui/material';import{BarChart,Bar,XAxis,YAxis,CartesianGrid,Tooltip,Legend,ResponsiveContainer,PieChart,Pie,Cell}from'recharts';import{migrationApi}from'../utils/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const COLORS=['#0088FE','#00C49F','#FFBB28','#FF8042','#8884D8'];const defaultData={stats:{total_migrations:0,average_age:0,male_percentage:0,female_percentage:0},reasons:[],age_stats:{},gender_stats:[],top_from_cities:[],top_to_cities:[]};const Analytics=()=>{const[data,setData]=useState(defaultData);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchData=async()=>{try{setLoading(true);const response=await migrationApi.getAnalytics();console.log('API Response:',response);// Проверяем и преобразуем данные\nconst stats=(response===null||response===void 0?void 0:response.stats)||{};const safeStats={total_migrations:Number(stats.total_migrations)||0,average_age:Number(stats.average_age)||0,male_percentage:Number(stats.male_percentage)||0,female_percentage:Number(stats.female_percentage)||0};// Проверяем и преобразуем массивы\nconst safeReasons=Array.isArray(response===null||response===void 0?void 0:response.reasons)?response.reasons.map(item=>({reason:String(item.reason||''),count:Number(item.count)||0})):[];const safeGenderStats=Array.isArray(response===null||response===void 0?void 0:response.gender_stats)?response.gender_stats.map(item=>({gender:String(item.gender||''),count:Number(item.count)||0})):[];const safeTopFromCities=Array.isArray(response===null||response===void 0?void 0:response.top_from_cities)?response.top_from_cities.map(item=>({city:String(item.city||''),count:Number(item.count)||0})):[];const safeTopToCities=Array.isArray(response===null||response===void 0?void 0:response.top_to_cities)?response.top_to_cities.map(item=>({city:String(item.city||''),count:Number(item.count)||0})):[];// Преобразуем age_stats\nconst safeAgeStats=(response===null||response===void 0?void 0:response.age_stats)||{};const processedAgeStats={};Object.entries(safeAgeStats).forEach(_ref=>{let[key,value]=_ref;processedAgeStats[key]=Number(value)||0;});setData({stats:safeStats,reasons:safeReasons,age_stats:processedAgeStats,gender_stats:safeGenderStats,top_from_cities:safeTopFromCities,top_to_cities:safeTopToCities});setError(null);}catch(err){setError('Ошибка при загрузке данных');console.error('Error fetching analytics:',err);}finally{setLoading(false);}};fetchData();},[]);if(loading){return/*#__PURE__*/_jsx(Box,{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",minHeight:\"80vh\",children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(error){return/*#__PURE__*/_jsx(Box,{p:3,children:/*#__PURE__*/_jsx(Typography,{color:\"error\",children:error})});}const ageData=Object.entries(data.age_stats).map(_ref2=>{let[age,count]=_ref2;return{age:`${age} лет`,count:Number(count)||0};});const formatNumber=value=>{if(value===undefined||value===null||isNaN(value)){return'0.0';}return value.toFixed(1);};return/*#__PURE__*/_jsxs(Box,{p:3,children:[/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"\\u041E\\u0431\\u0449\\u0430\\u044F \\u0441\\u0442\\u0430\\u0442\\u0438\\u0441\\u0442\\u0438\\u043A\\u0430\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"\\u0412\\u0441\\u0435\\u0433\\u043E \\u043C\\u0438\\u0433\\u0440\\u0430\\u0446\\u0438\\u0439\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:data.stats.total_migrations})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"\\u0421\\u0440\\u0435\\u0434\\u043D\\u0438\\u0439 \\u0432\\u043E\\u0437\\u0440\\u0430\\u0441\\u0442\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:formatNumber(data.stats.average_age)})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"\\u041C\\u0443\\u0436\\u0447\\u0438\\u043D\\u044B\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",children:[formatNumber(data.stats.male_percentage),\"%\"]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"\\u0416\\u0435\\u043D\\u0449\\u0438\\u043D\\u044B\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",children:[formatNumber(data.stats.female_percentage),\"%\"]})]})})]})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,height:'100%'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"\\u0420\\u0430\\u0441\\u043F\\u0440\\u0435\\u0434\\u0435\\u043B\\u0435\\u043D\\u0438\\u0435 \\u043F\\u043E \\u0432\\u043E\\u0437\\u0440\\u0430\\u0441\\u0442\\u0443\"}),/*#__PURE__*/_jsx(Box,{height:300,children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(BarChart,{data:ageData,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"age\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Legend,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"count\",fill:\"#8884d8\"})]})})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,height:'100%'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"\\u0420\\u0430\\u0441\\u043F\\u0440\\u0435\\u0434\\u0435\\u043B\\u0435\\u043D\\u0438\\u0435 \\u043F\\u043E \\u043F\\u043E\\u043B\\u0443\"}),/*#__PURE__*/_jsx(Box,{height:300,children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(PieChart,{children:[/*#__PURE__*/_jsx(Pie,{data:data.gender_stats,dataKey:\"count\",nameKey:\"gender\",cx:\"50%\",cy:\"50%\",outerRadius:80,label:true,children:data.gender_stats.map((entry,index)=>/*#__PURE__*/_jsx(Cell,{fill:COLORS[index%COLORS.length]},`cell-${index}`))}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Legend,{})]})})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,height:'100%'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"\\u0422\\u043E\\u043F-5 \\u0433\\u043E\\u0440\\u043E\\u0434\\u043E\\u0432 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsx(Box,{height:300,children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(BarChart,{data:data.top_from_cities,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"city\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Legend,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"count\",fill:\"#82ca9d\"})]})})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,height:'100%'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"\\u0422\\u043E\\u043F-5 \\u0433\\u043E\\u0440\\u043E\\u0434\\u043E\\u0432 \\u043D\\u0430\\u0437\\u043D\\u0430\\u0447\\u0435\\u043D\\u0438\\u044F\"}),/*#__PURE__*/_jsx(Box,{height:300,children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(BarChart,{data:data.top_to_cities,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"city\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Legend,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"count\",fill:\"#ffc658\"})]})})})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"\\u041F\\u0440\\u0438\\u0447\\u0438\\u043D\\u044B \\u043C\\u0438\\u0433\\u0440\\u0430\\u0446\\u0438\\u0438\"}),/*#__PURE__*/_jsx(Box,{height:300,children:/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:\"100%\",children:/*#__PURE__*/_jsxs(BarChart,{data:data.reasons,children:[/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"reason\"}),/*#__PURE__*/_jsx(YAxis,{}),/*#__PURE__*/_jsx(Tooltip,{}),/*#__PURE__*/_jsx(Legend,{}),/*#__PURE__*/_jsx(Bar,{dataKey:\"count\",fill:\"#ff7300\"})]})})})]})})]})]});};export default Analytics;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}