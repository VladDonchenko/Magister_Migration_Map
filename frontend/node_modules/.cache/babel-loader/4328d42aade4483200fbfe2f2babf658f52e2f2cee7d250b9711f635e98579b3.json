{"ast":null,"code":"import axios from'axios';// Используем относительный путь для работы через nginx\nconst API_BASE_URL='';const api=axios.create({baseURL:API_BASE_URL,headers:{'Content-Type':'application/json'}});const handleResponse=async response=>{if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}return response.json();};const validateMigrationData=data=>{if(!data||typeof data!=='object'){throw new Error('Invalid response format: expected an object');}if(!Array.isArray(data.cities)){throw new Error('Invalid cities format: expected an array');}if(!Array.isArray(data.migrations)){throw new Error('Invalid migrations format: expected an array');}// Валидация городов\ndata.cities.forEach(city=>{if(!city.name||typeof city.latitude!=='number'||typeof city.longitude!=='number'){throw new Error('Invalid city format');}});// Валидация миграций\ndata.migrations.forEach(migration=>{if(!migration.fromCity||!migration.toCity||typeof migration.count!=='number'||!Array.isArray(migration.migrants)){throw new Error('Invalid migration format');}});return data;};export const migrationApi={// Получение данных для карты\ngetMapData:async()=>{try{const response=await api.get('/api/migration/map');return validateMigrationData(response.data);}catch(error){console.error('Error fetching migration map data:',error);throw error;}},// Получение аналитики\ngetAnalytics:async()=>{const response=await api.get('/api/migration/analytics');return response.data;},// Получение регионов для страны\ngetRegions:async country=>{const response=await api.get(`/api/migration/regions?country=${country}`);return response.data;},// Загрузка CSV файла\nuploadCsv:async file=>{const formData=new FormData();formData.append('file',file);const response=await api.post('/api/migration/upload/csv',formData,{headers:{'Content-Type':'multipart/form-data'}});return response.data;},// Загрузка Excel файла\nuploadExcel:async file=>{const formData=new FormData();formData.append('file',file);const response=await api.post('/api/migration/upload/excel',formData,{headers:{'Content-Type':'multipart/form-data'}});return response.data;},// Экспорт данных\nexportData:async()=>{const response=await api.get('/api/migration/export',{responseType:'blob'});return response.data;},// Получение деталей потока миграции\ngetFlowDetails:async(fromCity,toCity)=>{try{const response=await api.get(`/api/migration/flows/${encodeURIComponent(fromCity)}/${encodeURIComponent(toCity)}/details`);return response.data;}catch(error){console.error('Error fetching flow details:',error);throw error;}},// Получение списка мигрантов\ngetMigrants:async(fromCity,toCity)=>{const response=await api.get(`/api/migration/flows/${encodeURIComponent(fromCity)}/${encodeURIComponent(toCity)}/migrants`);return response.data;},// Получение статистики города\ngetCityStats:async cityName=>{try{const response=await api.get(`/api/migration/stats/${encodeURIComponent(cityName)}`);return{outgoingCount:response.data.stats.outgoingCount||0,incomingCount:response.data.stats.incomingCount||0,averageDistance:response.data.stats.averageDistance||0};}catch(error){console.error('Error fetching city stats:',error);throw error;}},getStats:async()=>{try{const response=await api.get('/api/migration/stats');return response.data;}catch(error){console.error('Error fetching migration stats:',error);throw error;}}};export default migrationApi;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}