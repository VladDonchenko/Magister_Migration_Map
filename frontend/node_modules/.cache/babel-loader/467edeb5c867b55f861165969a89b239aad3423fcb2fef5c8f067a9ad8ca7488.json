{"ast":null,"code":"import React,{useEffect,useState}from'react';import{MapContainer,TileLayer,Polyline,Popup,useMap,CircleMarker}from'react-leaflet';import'leaflet/dist/leaflet.css';import{Box,Typography,Paper}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";// Функция для определения размера маркера на основе населения\nconst getMarkerSize=population=>{if(!population)return 8;if(population>1000000)return 20;if(population>500000)return 15;if(population>100000)return 10;return 8;};// Функция для определения цвета маркера на основе миграций\nconst getMarkerColor=city=>{const incoming=city.incomingMigrations||0;const outgoing=city.outgoingMigrations||0;if(incoming>outgoing)return'#4CAF50';if(outgoing>incoming)return'#F44336';return'#FFC107';};// Компонент для оновлення центру карти\nfunction ChangeView(_ref){let{center,zoom}=_ref;const map=useMap();useEffect(()=>{if(map){map.setView(center,zoom);}},[center,zoom,map]);return null;}const MigrationMap=_ref2=>{let{cities,migrations,onCityClick}=_ref2;const[center,setCenter]=useState([48.3794,31.1656]);const[zoom,setZoom]=useState(6);const[selectedMigration,setSelectedMigration]=useState(null);const[popupPosition,setPopupPosition]=useState(null);useEffect(()=>{console.log('MigrationMap props:',{cities,migrations});console.log('Migrations data:',migrations===null||migrations===void 0?void 0:migrations.map(m=>({from:m.fromCity.name,to:m.toCity.name,count:m.count,positions:[[m.fromCity.latitude,m.fromCity.longitude],[m.toCity.latitude,m.toCity.longitude]]})));if(cities&&cities.length>0){const firstCity=cities[0];setCenter([firstCity.latitude,firstCity.longitude]);}},[cities,migrations]);// Добавляем логирование для каждого города\nuseEffect(()=>{if(cities){cities.forEach(city=>{console.log(`City data for ${city.name}:`,{population:city.population,incomingMigrations:city.incomingMigrations,outgoingMigrations:city.outgoingMigrations,markerSize:getMarkerSize(city.population),markerColor:getMarkerColor(city)});});}},[cities]);if(!cities||!migrations){console.warn('MigrationMap: cities or migrations is undefined');return null;}if(!Array.isArray(cities)||!Array.isArray(migrations)){console.warn('MigrationMap: cities or migrations is not an array');return null;}return/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',height:'100vh'},children:[/*#__PURE__*/_jsxs(Paper,{sx:{width:300,p:2,overflow:'auto'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\u0424\\u0438\\u043B\\u044C\\u0442\\u0440\\u044B\"}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"\\u0421\\u0442\\u0430\\u0442\\u0438\\u0441\\u0442\\u0438\\u043A\\u0430\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u0412\\u0441\\u0435\\u0433\\u043E \\u043C\\u0438\\u0433\\u0440\\u0430\\u0446\\u0438\\u0439: \",(migrations===null||migrations===void 0?void 0:migrations.length)||0]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u0423\\u043D\\u0438\\u043A\\u0430\\u043B\\u044C\\u043D\\u044B\\u0445 \\u043C\\u0430\\u0440\\u0448\\u0440\\u0443\\u0442\\u043E\\u0432: \",new Set((migrations||[]).map(m=>`${m.fromCity.name}-${m.toCity.name}`)).size]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",gutterBottom:true,children:\"\\u041B\\u0435\\u0433\\u0435\\u043D\\u0434\\u0430\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Box,{sx:{width:20,height:20,borderRadius:'50%',backgroundColor:'#4CAF50',mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"\\u0411\\u043E\\u043B\\u044C\\u0448\\u0435 \\u043F\\u0440\\u0438\\u0431\\u044B\\u0432\\u0448\\u0438\\u0445\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Box,{sx:{width:20,height:20,borderRadius:'50%',backgroundColor:'#F44336',mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"\\u0411\\u043E\\u043B\\u044C\\u0448\\u0435 \\u0432\\u044B\\u0431\\u044B\\u0432\\u0448\\u0438\\u0445\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsx(Box,{sx:{width:20,height:20,borderRadius:'50%',backgroundColor:'#FFC107',mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"\\u0420\\u0430\\u0432\\u043D\\u043E\\u0435 \\u043A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{mt:1},children:\"\\u0420\\u0430\\u0437\\u043C\\u0435\\u0440 \\u043C\\u0430\\u0440\\u043A\\u0435\\u0440\\u0430 \\u0437\\u0430\\u0432\\u0438\\u0441\\u0438\\u0442 \\u043E\\u0442 \\u043D\\u0430\\u0441\\u0435\\u043B\\u0435\\u043D\\u0438\\u044F \\u0433\\u043E\\u0440\\u043E\\u0434\\u0430\"})]})]}),/*#__PURE__*/_jsx(Box,{sx:{flexGrow:1},children:/*#__PURE__*/_jsxs(MapContainer,{center:center,zoom:zoom,style:{height:'100%',width:'100%'},children:[/*#__PURE__*/_jsx(ChangeView,{center:center,zoom:zoom}),/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\"}),(migrations||[]).map((migration,index)=>{const positions=[[migration.fromCity.latitude,migration.fromCity.longitude],[migration.toCity.latitude,migration.toCity.longitude]];const center=[(migration.fromCity.latitude+migration.toCity.latitude)/2,(migration.fromCity.longitude+migration.toCity.longitude)/2];return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Polyline,{positions:positions,pathOptions:{color:migration.count>10?'#ff0000':'#0000ff',weight:Math.max(3,Math.min(migration.count,8)),opacity:0.8,interactive:true},eventHandlers:{click:e=>{console.log('Click event:',e);console.log('Migration data:',migration);setSelectedMigration(migration);setPopupPosition(center);e.originalEvent.stopPropagation();e.target.openPopup();},mouseover:e=>{const layer=e.target;layer.setStyle({weight:Math.max(5,Math.min(migration.count,10)),opacity:1});},mouseout:e=>{const layer=e.target;layer.setStyle({weight:Math.max(3,Math.min(migration.count,8)),opacity:0.8});}}}),selectedMigration===migration&&popupPosition&&/*#__PURE__*/_jsx(Popup,{position:popupPosition,eventHandlers:{remove:()=>{setSelectedMigration(null);setPopupPosition(null);}},children:/*#__PURE__*/_jsxs(Box,{sx:{minWidth:200},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\u041C\\u0438\\u0433\\u0440\\u0430\\u0446\\u0438\\u043E\\u043D\\u043D\\u044B\\u0439 \\u043F\\u043E\\u0442\\u043E\\u043A\"}),/*#__PURE__*/_jsxs(Typography,{children:[\"\\u0418\\u0437: \",migration.fromCity.name]}),/*#__PURE__*/_jsxs(Typography,{children:[\"\\u0412: \",migration.toCity.name]}),/*#__PURE__*/_jsxs(Typography,{children:[\"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u043C\\u0438\\u0433\\u0440\\u0430\\u043D\\u0442\\u043E\\u0432: \",migration.count]}),migration.migrants&&migration.migrants.length>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",sx:{mt:1},children:\"\\u041F\\u0440\\u0438\\u0447\\u0438\\u043D\\u044B \\u043C\\u0438\\u0433\\u0440\\u0430\\u0446\\u0438\\u0438:\"}),/*#__PURE__*/_jsx(\"ul\",{style:{margin:'4px 0',paddingLeft:20},children:Array.from(new Set(migration.migrants.map(m=>m.reason))).filter(Boolean).map((reason,idx)=>/*#__PURE__*/_jsx(\"li\",{children:reason},idx))})]})]})})]},index);}),(cities||[]).map((city,index)=>{var _city$population,_city$incomingMigrati,_city$outgoingMigrati;return/*#__PURE__*/_jsx(CircleMarker,{center:[city.latitude,city.longitude],radius:getMarkerSize(city.population),fillColor:getMarkerColor(city),color:\"#000\",weight:1,opacity:0.8,fillOpacity:0.6,eventHandlers:{click:()=>onCityClick(city)},children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:city.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041D\\u0430\\u0441\\u0435\\u043B\\u0435\\u043D\\u0438\\u0435: \",((_city$population=city.population)===null||_city$population===void 0?void 0:_city$population.toLocaleString())||'Нет данных']}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u041F\\u0440\\u0438\\u0431\\u044B\\u043B\\u043E: \",((_city$incomingMigrati=city.incomingMigrations)===null||_city$incomingMigrati===void 0?void 0:_city$incomingMigrati.toLocaleString())||'0']}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0412\\u044B\\u0431\\u044B\\u043B\\u043E: \",((_city$outgoingMigrati=city.outgoingMigrations)===null||_city$outgoingMigrati===void 0?void 0:_city$outgoingMigrati.toLocaleString())||'0']})]})})},index);})]})})]});};export default MigrationMap;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}