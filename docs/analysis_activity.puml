@startuml
skinparam activity {
  BackgroundColor White
  BorderColor DarkBlue
  FontColor DarkBlue
}

start
:Отримання запиту на аналіз;
fork
  :Завантаження даних;
  fork
    :Отримання міграційних даних;
    :Отримання даних міст;
    :Отримання додаткових даних;
  end fork
  :Попередня обробка даних;
  :Нормалізація формату;
fork again
  :Розрахунок метрик;
  fork
    :Розрахунок базових метрик;
    :Розрахунок складних метрик;
    :Розрахунок трендів;
  end fork
  :Агрегація результатів;
fork again
  :Візуалізація даних;
  fork
    :Побудова графіків;
    :Створення діаграм;
    :Формування звітів;
  end fork
  :Оптимізація відображення;
end fork
:Формування результату;
:Повернення результату;
stop

note right
  Процес аналізу даних включає
  паралельну обробку даних,
  розрахунок метрик та
  візуалізацію результатів
end note

start
:Отримання запиту на фільтрацію;
if (Тип фільтра?) then (За період)
  :Фільтрація за датою;
  :Оновлення метрик;
else if (За регіоном) then
  :Фільтрація за географією;
  :Оновлення метрик;
else if (За демографією) then
  :Фільтрація за параметрами;
  :Оновлення метрик;
else (Комбінований)
  :Застосування всіх фільтрів;
  :Оновлення метрик;
endif
:Оновлення візуалізації;
:Повернення результату;
stop

note right
  Процес фільтрації даних
  включає різні сценарії
  обробки залежно від типу
  фільтра
end note

start
:Отримання запиту на звіт;
:Формування структури звіту;
fork
  :Збір даних;
  :Розрахунок метрик;
  :Формування графіків;
fork again
  :Підготовка тексту;
  :Формування висновків;
  :Додавання рекомендацій;
end fork
:Формування фінального звіту;
:Експорт у вибраний формат;
stop

note right
  Процес формування звіту
  включає паралельну підготовку
  даних та текстової частини
end note
@enduml 